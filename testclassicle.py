import unittest
from classicle_model import classicle_model
import csv
import os

# ~ test_texts = ["tv future in the hands of viewers with home theatre systems  plasma high-definition tvs  and digital video recorders moving into the living room  the way people watch tv will be radically different in five years  time.  that is according to an expert panel which gathered at the annual consumer electronics show in las vegas to discuss how these new technologies will impact one of our favourite pastimes. with the us leading the trend  programmes and other content will be delivered to viewers via home networks  through cable  satellite  telecoms companies  and broadband service providers to front rooms and portable devices.  one of the most talked-about technologies of ces has been digital and personal video recorders (dvr and pvr). these set-top boxes  like the us s tivo and the uk s sky+ system  allow people to record  store  play  pause and forward wind tv programmes when they want.  essentially  the technology allows for much more personalised tv. they are also being built-in to high-definition tv sets  which are big business in japan and the us  but slower to take off in europe because of the lack of high-definition programming. not only can people forward wind through adverts  they can also forget about abiding by network and channel schedules  putting together their own a-la-carte entertainment. but some us networks and cable and satellite companies are worried about what it means for them in terms of advertising revenues as well as  brand identity  and viewer loyalty to channels. although the us leads in this technology at the moment  it is also a concern that is being raised in europe  particularly with the growing uptake of services like sky+.  what happens here today  we will see in nine months to a years  time in the uk   adam hume  the bbc broadcast s futurologist told the bbc news website. for the likes of the bbc  there are no issues of lost advertising revenue yet. it is a more pressing issue at the moment for commercial uk broadcasters  but brand loyalty is important for everyone.  we will be talking more about content brands rather than network brands   said tim hanlon  from brand communications firm starcom mediavest.  the reality is that with broadband connections  anybody can be the producer of content.  he added:  the challenge now is that it is hard to promote a programme with so much choice.   what this means  said stacey jolna  senior vice president of tv guide tv group  is that the way people find the content they want to watch has to be simplified for tv viewers. it means that networks  in us terms  or channels could take a leaf out of google s book and be the search engine of the future  instead of the scheduler to help people find what they want to watch. this kind of channel model might work for the younger ipod generation which is used to taking control of their gadgets and what they play on them. but it might not suit everyone  the panel recognised. older generations are more comfortable with familiar schedules and channel brands because they know what they are getting. they perhaps do not want so much of the choice put into their hands  mr hanlon suggested.  on the other end  you have the kids just out of diapers who are pushing buttons already - everything is possible and available to them   said mr hanlon.  ultimately  the consumer will tell the market they want.   of the 50 000 new gadgets and technologies being showcased at ces  many of them are about enhancing the tv-watching experience. high-definition tv sets are everywhere and many new models of lcd (liquid crystal display) tvs have been launched with dvr capability built into them  instead of being external boxes. one such example launched at the show is humax s 26-inch lcd tv with an 80-hour tivo dvr and dvd recorder. one of the us s biggest satellite tv companies  directtv  has even launched its own branded dvr at the show with 100-hours of recording capability  instant replay  and a search function. the set can pause and rewind tv for up to 90 hours. and microsoft chief bill gates announced in his pre-show keynote speech a partnership with tivo  called tivotogo  which means people can play recorded programmes on windows pcs and mobile devices. all these reflect the increasing trend of freeing up multimedia so that people can watch what they want  when they want.",
# ~ "yeading face newcastle in fa cup premiership side newcastle united face a trip to ryman premier league leaders yeading in the fa cup third round.  the game - arguably the highlight of the draw - is a potential money-spinner for non-league yeading  who beat slough in the second round. conference side exeter city  who knocked out doncaster on saturday  will travel to old trafford to meet holders manchester united in january. arsenal were drawn at home to stoke and chelsea will play host to scunthorpe. the only other non-league side in the draw are hinckley united  who held brentford to a goalless draw on sunday. they will meet league one leaders luton if they win their replay against martin allen s team at griffin park.  a number of premiership teams face difficult away games against championship sides on the weekend of 8/9 january. third-placed everton visit plymouth  liverpool travel to burnley  crystal palace go to sunderland  fulham face carling cup semi-finalists watford  bolton meet ipswich  while aston villa were drawn against sheffield united. premiership strugglers norwich  blackburn  west brom are away at west ham  cardiff and preston north end respectively. southampton visit northampton  having already beaten the league two side in the carling cup earlier this season. middlesbrough were drawn away against either swindon or notts county  while spurs entertain brighton at white hart lane.  arsenal v stoke  swindon/notts co v middlesbrough  man utd v exeter  plymouth v everton  leicester v blackpool  derby v wigan  sunderland v crystal palace  wolves v millwall  yeading v newcastle  hull v colchester  tottenham v brighton  reading v stockport/swansea  birmingham v leeds  hartlepool v boston  milton keynes dons v peterborough  oldham v man city  chelsea v scunthorpe  cardiff v blackburn  charlton v rochdale  west ham v norwich  sheff utd v aston villa  preston v west brom  rotherham v yeovil  burnley v liverpool  bournemouth v chester  coventry v crewe  watford v fulham  ipswich v bolton  portsmouth v gillingham  northampton v southampton  qpr v nottm forest  luton v hinckley/brentford  matches to be played on weekend of 8/9 january.",
# ~ "how political squabbles snowball it s become commonplace to argue that blair and brown are like squabbling school kids and that they (and their supporters) need to grow up and stop bickering.  but this analysis in fact gets it wrong. it s not just children who fight - adults do too. and there are solid reasons why even a trivial argument between mature protagonists can be hard to stop once its got going. the key feature of an endless feud is that everyone can agree they d be better off if it ended - but everyone wants to have the last word.  each participant genuinely wants the row to stop  but thinks it worth prolonging the argument just a tiny bit to ensure their view is heard. their successive attempts to end the argument with their last word ensure the argument goes on and on and on. (in the case of mr blair and mr brown  successive books are published  ensuring the issues never die.) now this isn t because the participants are stupid - it s actually each individual behaving entirely rationally  given the incentives facing them. indeed  there s even a piece of economic theory that explains all this. nothing as obscure as  post-neo-classical endogenous growth theory  which the chancellor himself once quoted - but a ubiquitous piece of game theory which all respectable policy wonks are familiar with.  it s often referred to as the  prisoner s dilemma   based on a parable much told in economics degree courses... about a sheriff and two prisoners. the story goes that two prisoners are jointly charged with a heinous crime  and are locked up in separate cells. but the sheriff desperately needs a confession from at least one of them  to provide enough evidence to convict them of the crime. without a confession  the prisoners will get a minimal sentence on some trumped up charge.  clearly the prisoners  best strategy is to keep their mouths shut  and take the short sentence  but the clever sheriff has an idea to induce them to talk. he tells each prisoner separately  that if they confess - and they are the only one to confess - they ll be let off their crime. and he tells them that if they don t confess - and they are the only one not to confess - they ll get life. now  if you are prisoner confronted with this choice  your best bet is to confess. if your partner doesn t confess  you ll get off completely. and if your partner does confess  you d better confess to ensure you don t get life. the result is of course  both prisoners confess  so the sheriff does not have to let either one off. both prisoners  individual logic was to behave that way  even though both would have been better if they had somehow agreed to shut up. don t worry if you don t entirely follow it - you can to look it up on google  where there are 283 000 entries on it.  the prisoners  dilemma and all its ramifications have truly captured economists in the last couple of decades. it is a parable used to describe any situation where there is an obvious sensible choice to be taken collectively  but where the only rational choice individually is to behave selfishly.  a cold war arms race for example - a classic case where both russia and america would be better off with just a few arms  rather than a lot of arms. but as long as each wants just a few more arms than the other  an arms race ensues with the results that the individually logical decision to buy more arms  results in arms levels that are too high. what economics tells us is that once you re in a prisoners  dilemma - unless you are repeating the experience many times over - it s hard to escape the perverse logic of it. it s no good just exhorting people to stop buying arms  or to stop arguing when all their incentives encourage them to carry on. somehow  the incentives have to change.  in the case of the labour party  if you believe the rift between blair and brown camps is as bad as the reports suggest  solomon s wisdom needs to be deployed to solve the problem. every parent knows there are ingenious solutions to arguments  solutions which affect the incentives of the participants. an example  is the famous rule that  one divides  the other chooses  as a way of allocating a piece of cake to be sliced up between greedy children. in the case of an apparently endless argument  if you want it to come to an end  you have to ensure the person who has the last word is one who loses rather than the one who wins the row. the cost of prolonging the row by even one more briefing  or one more book for that matter  has to exceed the benefit of having the last word  and getting your point in. if the rest of the party can enforce that  they ll have the protagonists retreating pretty quickly.",
# ~ "dance music not dead says fatboy dj norman cook - aka fatboy slim - has said that dance music is not dead  but has admitted it is currently going through a  fallow patch .  the commercial failure of the latest albums by britain s two biggest dance acts - fatboy slim s palookaville and the prodigy s always outnumbered never outgunned - has been coupled with the closure of many  superclubs   and the folding of three dance music magazines. last month the brit awards announced they would no longer be awarding a best dance act prize  with the brits committee announcing that  dance music is no longer where it s happening in music.  these developments lead some to suggest that dance was finished as a popular music genre. cook acknowledged that much change in the dance world in the four years since his last album  halfway between the gutter and the stars  but he stressed this did not mean the dance scene was permanently over.  every week when i was making the album  i was reading articles about the demise of dance music - and obviously that affects you somewhat   he told bbc world service s the ticket programme.  i personally don t believe it s either dead or going to die  but it s going through a bit of a fallow patch.  so i think  consciously or subconsciously  reading every week that dance music was dead i would think  right  scrub that track then .   although his album sales in the uk are down - palookaville stayed in the uk top 75 for just three weeks - cook has achieved recent global success with his beach parties. and event on brighton sea front in 2002 attracted 250 000  people  while a later one in rio achieved a crowd of 360 000. the dvd of the rio set was the biggest seller of that year.   with a crowd that big  if the weather s nice  the atmosphere before i even go is so good that about halfway through the first record i think  i ve got them    cook said.  i m always really really nervous before the big ones - they had to give me valium before rio  because two hours before i was literally just pacing the floor.  for some reason  especially now i ve got a reputation for it  the atmosphere and the joie de vivre that s already going on means all i have to do is play  up  records.  he promised more such parties in more locations around the world - despite problems after the brighton event  which ended in chaos with many revellers finding themselves stranded as transport ground to a halt. one man also died of a heart attack  and a woman fell to her death during the free party.  we re having to widen our horizons from just beaches  because there s landlocked countries that want to get involved   cook said.  we re doing rio at the carnival  at the maracana  and sao paolo - our new gig is famous football stadiums.   the dj admitted  however  that his massive worldwide success had a downside  with intense media interest in his personal life. in particular  he said he had struggled to cope with tabloid intrusion during the temporary break-up of his marriage to radio one presenter zoe ball  after she was linked with dj dan peppe.   the tabloid thing has been difficult at times   cook said.  especially the me-and-zoe-gate - it s quite scary.  he said that he had been  determined  that what had happened with ball did not affect the album.  at first i was doing deliberately jolly tunes so that people wouldn t think i was depressed   he explained.  then i thought   that s not right .  and he highlighted a bizarre coincidence - that one song written before they split had turned out to have a great deal more meaning than intended.  i said to zoe   i did this track called my masochistic baby went and left me  do you mind if it s on the album    he recalled.  she said   yeah  it s hilarious  because your masochistic baby did leave you .  cook also added that he had some ways of coping with the intense paparazzi pressure  which accumulates at the end of the private road he lives on - where paul mccartney is a neighbour.  it s almost like prisoners rattling the bars with their mugs   cook explained.  if there s a pap at the end of the road  everyone knocks on each other s doors - paul comes round  and we warn him  because we don t know who they re after.",
# ~ "ban on forced retirement under 65 employers will no longer be able to force workers to retire before 65  unless they can justify it.  the government has announced that firms will be barred from 2006 from imposing arbitrary retirement ages. under new european age discrimination rules  a default retirement age of 65 will be introduced. workers will be permitted to request staying on beyond this compulsory retirement age  although employers will have the right to refuse. trade and industry secretary patricia hewitt said people would not be forced to work longer than they wanted  saying the default age was not a statutory  compulsory retirement age. she said employers would be free to continue employing people for as long as they were competent.  under age discrimination proposals from the department of trade and industry last year workers were to be allowed to work on till 70 if they wished.  business leaders had opposed the plan as they said it would be too costly and cumbersome. the british chambers of commerce welcomed the latest proposal.  this move today is the best of both worlds   it said.  employers have the ability to define the end point of the employer-employee relationship and employees have flexibility with a right to request to work past the age of 65.  but age concern said imposing a retirement age of 65 was  cowardly  and a  complete u-turn .  this makes a mockery of the government s so-called commitment to outlawing ageism  leaving the incoming age discrimination law to unravel   said gordon lishman  director general of age concern england .  it is now inevitable that older people will mount legal challenges to the decision using european law.  the decision will have no impact on the age at which workers can collect their state pension  the government has said."]
# ~ test_labels = ["tech", "sport", "politics", "entertainment", "business"] # testing on testing data starts from the third element
test_texts = []
test_labels = []
with open(os.path.join(os.path.dirname(__file__), "data", "bbc-text.csv"), 'r') as csvfile:
    reader = csv.reader(csvfile, delimiter=',')
    next(reader)
    for row in reader:
        test_texts.append(row[1])
        test_labels.append(row[0])
m = 10
# testing on m training examples
# ~ test_texts = test_texts[:m]
# ~ test_labels = test_labels[:m]

# testing on m testing examples
test_texts = test_texts[-m:]
test_labels = test_labels[-m:]
n = len(test_labels)
model_name = 'model-bilstm'
class ModelTest(unittest.TestCase):
    def test_articles(self):
        """
        Test article's category whether its topic is from these 5 classes: business, tech, entertainment, politics, or sport
        """
        for i in range(n):
            with self.subTest(i=i):
                self.assertEqual(classicle_model(test_texts[i], model_name), test_labels[i])
    def test_sub_articles(self):
        """
        Test sub-article's category, the subset is determined by sub variable fraction
        """
        sub = 0.5
        for i in range(n):
            with self.subTest(i=i):
                self.assertEqual(
                    classicle_model(
                        test_texts[i][:int(len(test_texts[i])*sub)], model_name), 
                        test_labels[i])
                        
if __name__ == '__main__':
    unittest.main()
